# Project: adams
# Date: 2014-05-14 16:53:21
# User: fracpete
#
adams.flow.control.Flow
	-annotation
	Queries Weather Underground every 15min for an update on the conditions \nin Hamilton, NZ, and plots them.\nSince using the API requires a key, the user gets prompted to provide one.\nRegister for a free API key here:\nhttp://www.wunderground.com/weather/api/
	-actor
		adams.flow.standalone.GridView
			-actor
				adams.flow.sink.SequencePlotter
					-name
					Temperature
					-writer
						adams.gui.print.NullWriter
					-paintlet
						adams.gui.visualization.sequence.LinePaintlet
					-overlay-paintlet
						adams.gui.visualization.sequence.CirclePaintlet
					-marker-paintlet
						adams.flow.sink.sequenceplotter.NoMarkers
					-error-paintlet
						adams.flow.sink.sequenceplotter.NoErrorPaintlet
					-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-overlay-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-title
					Temperature
					-axis-x
						adams.gui.visualization.core.AxisPanelOptions
							-label
							time (utc)
							-type
							TIME
							-tick-generator
								adams.gui.visualization.core.axis.SimpleTickGenerator
							-width
							40
							-custom-format
							M/d HH:mm
					-axis-y
						adams.gui.visualization.core.AxisPanelOptions
							-label
							temperature (C)
							-tick-generator
								adams.gui.visualization.core.axis.SimpleTickGenerator
							-width
							80
							-custom-format
							0.0
					-plot-updater
						adams.flow.sink.sequenceplotter.SimplePlotUpdater
					-post-processor
						adams.flow.sink.sequenceplotter.PassThrough
			-actor
				adams.flow.sink.SequencePlotter
					-name
					Wind
					-writer
						adams.gui.print.NullWriter
					-paintlet
						adams.gui.visualization.sequence.LinePaintlet
					-overlay-paintlet
						adams.gui.visualization.sequence.CirclePaintlet
					-marker-paintlet
						adams.flow.sink.sequenceplotter.NoMarkers
					-error-paintlet
						adams.flow.sink.sequenceplotter.NoErrorPaintlet
					-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-overlay-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-title
					Wind
					-axis-x
						adams.gui.visualization.core.AxisPanelOptions
							-label
							time (utc)
							-type
							TIME
							-tick-generator
								adams.gui.visualization.core.axis.SimpleTickGenerator
							-width
							40
							-custom-format
							M/d HH:mm
					-axis-y
						adams.gui.visualization.core.AxisPanelOptions
							-label
							wind (kph)
							-tick-generator
								adams.gui.visualization.core.axis.SimpleTickGenerator
							-width
							80
							-custom-format
							0.0
					-plot-updater
						adams.flow.sink.sequenceplotter.SimplePlotUpdater
					-post-processor
						adams.flow.sink.sequenceplotter.PassThrough
			-actor
				adams.flow.sink.SequencePlotter
					-name
					Pressure
					-writer
						adams.gui.print.NullWriter
					-paintlet
						adams.gui.visualization.sequence.LinePaintlet
					-overlay-paintlet
						adams.gui.visualization.sequence.CirclePaintlet
					-marker-paintlet
						adams.flow.sink.sequenceplotter.NoMarkers
					-error-paintlet
						adams.flow.sink.sequenceplotter.NoErrorPaintlet
					-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-overlay-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-title
					Pressure
					-axis-x
						adams.gui.visualization.core.AxisPanelOptions
							-label
							time (utc)
							-type
							TIME
							-tick-generator
								adams.gui.visualization.core.axis.SimpleTickGenerator
							-width
							40
							-custom-format
							M/d HH:mm
					-axis-y
						adams.gui.visualization.core.AxisPanelOptions
							-label
							pressure (mb)
							-tick-generator
								adams.gui.visualization.core.axis.SimpleTickGenerator
							-width
							80
							-custom-format
							0.0
					-plot-updater
						adams.flow.sink.sequenceplotter.SimplePlotUpdater
					-post-processor
						adams.flow.sink.sequenceplotter.PassThrough
			-num-rows
			3
			-writer
				adams.gui.print.NullWriter
	-actor
		adams.flow.source.Start
	-actor
		adams.flow.control.Trigger
			-name
			build URL
			-tee
				adams.flow.source.EnterValue
					-stop-if-canceled
					true
					-custom-stop-message
					User didn't provide API key!
					-message
					Please enter your Weather Underground API key:
			-tee
				adams.flow.transformer.SetVariable
					-var-name
					api
			-tee
				adams.flow.transformer.StringInsert
					-position
					first
					-value
					http://api.wunderground.com/api/
			-tee
				adams.flow.transformer.StringInsert
					-name
					StringInsert-1
					-after
					true
					-value
					/conditions/q/NZ/Hamilton.xml
			-tee
				adams.flow.transformer.SetVariable
					-name
					SetVariable-1
					-var-name
					url
	-actor
		adams.flow.control.WhileLoop
			-condition
				adams.flow.condition.bool.True
			-loop
				adams.flow.source.Start
			-loop
				adams.flow.control.Trigger
					-name
					download/process XML
					-tee
						adams.flow.source.URLSupplier
							-url
							@{url}
					-tee
						adams.flow.transformer.DownloadContent
					-tee
						adams.flow.transformer.Convert
							-conversion
								adams.data.conversion.XMLToDOM
					-tee
						adams.flow.control.Tee
							-name
							timestamp
							-tee
								adams.flow.transformer.XPath
									-expression
									/response/current_observation/local_epoch
									-result-type
									NUMBER
							-tee
								adams.flow.transformer.MathExpression
									-expression
									X*1000
							-tee
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.DoubleToString
											-num-decimals
											0
											-fixed-decimals
											true
							-tee
								adams.flow.transformer.SetVariable
									-var-name
									msec
					-tee
						adams.flow.control.Tee
							-name
							temperature
							-tee
								adams.flow.transformer.XPath
									-expression
									/response/current_observation/temp_c
									-result-type
									STRING
							-tee
								adams.flow.control.Injector
									-injection
									@{msec}
									-location
									BEFORE
							-tee
								adams.flow.control.Cast
									-classname
									java.lang.String
							-tee
								adams.flow.transformer.Convert
									-name
									Convert-1
									-conversion
										adams.data.conversion.StringToDouble
							-tee
								adams.flow.transformer.SequenceToArray
									-length
									2
							-tee
								adams.flow.transformer.MakePlotContainer
									-plot-name
									temperature
							-tee
								adams.flow.sink.CallableSink
									-callable
									Temperature
					-tee
						adams.flow.control.Tee
							-name
							wind
							-tee
								adams.flow.transformer.XPath
									-expression
									/response/current_observation/wind_kph
									-result-type
									STRING
							-tee
								adams.flow.control.Injector
									-injection
									@{msec}
									-location
									BEFORE
							-tee
								adams.flow.control.Cast
									-classname
									java.lang.String
							-tee
								adams.flow.transformer.Convert
									-name
									Convert-1
									-conversion
										adams.data.conversion.StringToDouble
							-tee
								adams.flow.transformer.SequenceToArray
									-length
									2
							-tee
								adams.flow.transformer.MakePlotContainer
									-plot-name
									wind
							-tee
								adams.flow.sink.CallableSink
									-callable
									Wind
					-tee
						adams.flow.control.Tee
							-name
							pressure
							-tee
								adams.flow.transformer.XPath
									-expression
									/response/current_observation/pressure_mb
									-result-type
									STRING
							-tee
								adams.flow.control.Injector
									-injection
									@{msec}
									-location
									BEFORE
							-tee
								adams.flow.control.Cast
									-classname
									java.lang.String
							-tee
								adams.flow.transformer.Convert
									-name
									Convert-1
									-conversion
										adams.data.conversion.StringToDouble
							-tee
								adams.flow.transformer.SequenceToArray
									-length
									2
							-tee
								adams.flow.transformer.MakePlotContainer
									-plot-name
									pressure
							-tee
								adams.flow.sink.CallableSink
									-callable
									Pressure
			-loop
				adams.flow.control.Sleep
					-interval
					900000
	-flow-execution-listener
		adams.flow.execution.NullListener

