# Project: adams
# Date: 2015-05-31 10:52:40
# User: fracpete
# Charset: UTF-8
#
adams.flow.control.Flow
	-annotation
	Uses flow components to give an overview of the system\'s performance.
	-actor
		adams.flow.standalone.GridView
			-name
			System performance
			-short-title
			true
			-x
			-2
			-y
			-2
			-actor
				adams.flow.sink.SequencePlotter
					-name
					CPU
					-writer
						adams.gui.print.NullWriter
					-paintlet
						adams.gui.visualization.sequence.CirclePaintlet
					-overlay-paintlet
						adams.gui.visualization.sequence.LOWESSOverlayPaintlet
							-color
							#ff0000
							-window
							50
					-marker-paintlet
						adams.flow.sink.sequenceplotter.NoMarkers
					-error-paintlet
						adams.flow.sink.sequenceplotter.NoErrorPaintlet
					-mouse-click-action
						adams.flow.sink.sequenceplotter.NullClickAction
					-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-overlay-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-title
					CPU
					-axis-x
						adams.gui.visualization.core.AxisPanelOptions
							-label
							evaluations
							-tick-generator
								adams.gui.visualization.core.axis.FancyTickGenerator
							-nth-value
							2
							-width
							40
							-custom-format
							0
					-axis-y
						adams.gui.visualization.core.AxisPanelOptions
							-label
							msec
							-tick-generator
								adams.gui.visualization.core.axis.FancyTickGenerator
							-nth-value
							2
							-width
							60
							-top-margin
							0.05
							-bottom-margin
							0.05
							-custom-format
							0
					-plot-updater
						adams.flow.sink.sequenceplotter.SimplePlotUpdater
							-update-interval
							@{cpu_plot_update}
					-post-processor
						adams.flow.sink.sequenceplotter.PassThrough
			-actor
				adams.flow.sink.SequencePlotter
					-name
					Write
					-writer
						adams.gui.print.NullWriter
					-paintlet
						adams.gui.visualization.sequence.CirclePaintlet
					-overlay-paintlet
						adams.gui.visualization.sequence.LOWESSOverlayPaintlet
							-color
							#ff0000
							-window
							50
					-marker-paintlet
						adams.flow.sink.sequenceplotter.NoMarkers
					-error-paintlet
						adams.flow.sink.sequenceplotter.NoErrorPaintlet
					-mouse-click-action
						adams.flow.sink.sequenceplotter.NullClickAction
					-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-overlay-color-provider
						adams.gui.visualization.core.DefaultColorProvider
					-title
					Write
					-axis-x
						adams.gui.visualization.core.AxisPanelOptions
							-label
							evaluations
							-tick-generator
								adams.gui.visualization.core.axis.FancyTickGenerator
							-nth-value
							2
							-width
							40
							-custom-format
							0
					-axis-y
						adams.gui.visualization.core.AxisPanelOptions
							-label
							msec
							-tick-generator
								adams.gui.visualization.core.axis.FancyTickGenerator
							-nth-value
							2
							-width
							60
							-top-margin
							0.05
							-bottom-margin
							0.05
							-custom-format
							0
					-plot-updater
						adams.flow.sink.sequenceplotter.SimplePlotUpdater
							-update-interval
							@{write_plot_update}
					-post-processor
						adams.flow.sink.sequenceplotter.PassThrough
			-actor
				adams.flow.sink.Display
					-name
					Overall
					-writer
						adams.data.io.output.NullWriter
			-num-rows
			3
			-writer
				adams.gui.print.NullWriter
	-actor
		adams.flow.standalone.CallableActors
			-actor
				adams.flow.control.Sequence
					-name
					timing_write
					-actor
						adams.flow.control.ContainerValuePicker
							-value
							msec
							-switch-outputs
							true
					-actor
						adams.flow.transformer.MakePlotContainer
							-plot-name
							Write speed
					-actor
						adams.flow.sink.CallableSink
							-callable
							Write
			-actor
				adams.flow.control.Sequence
					-name
					timing_cpuspeed
					-actor
						adams.flow.control.ContainerValuePicker
							-value
							msec
							-switch-outputs
							true
					-actor
						adams.flow.transformer.MakePlotContainer
							-plot-name
							CPU Speed
					-actor
						adams.flow.sink.CallableSink
							-callable
							CPU
			-actor
				adams.flow.control.Sequence
					-name
					timing_overall
					-actor
						adams.flow.control.ContainerValuePicker
							-tee
								adams.flow.transformer.SetVariable
									-var-name
									msec
							-value
							msec
					-actor
						adams.flow.control.ContainerValuePicker
							-name
							ContainerValuePicker-1
							-tee
								adams.flow.transformer.SetVariable
									-var-name
									prefix
							-value
							Prefix
					-actor
						adams.flow.control.Trigger
							-name
							generate output
							-tee
								adams.flow.source.CombineVariables
									-expression
									Overall @{prefix}: @{msec} msec
							-tee
								adams.flow.sink.CallableSink
									-callable
									Overall
	-actor
		adams.flow.standalone.Standalones
			-name
			speed variables
			-actor
				adams.flow.standalone.SetVariable
					-name
					# curves
					-var-name
					num_curves
					-var-value
					500
			-actor
				adams.flow.standalone.SetVariable
					-name
					# means
					-var-name
					num_means
					-var-value
					5
			-actor
				adams.flow.standalone.SetVariable
					-name
					# stdevs
					-var-name
					num_stdevs
					-var-value
					5
			-actor
				adams.flow.standalone.SetVariable
					-name
					# data points
					-var-name
					num_points
					-var-value
					200
			-actor
				adams.flow.standalone.SetVariable
					-name
					cpu plot update interval
					-var-name
					cpu_plot_update
					-var-value
					100
	-actor
		adams.flow.standalone.Standalones
			-name
			write variables
			-actor
				adams.flow.standalone.SetVariable
					-name
					number of files
					-var-name
					num_files
					-var-value
					500
			-actor
				adams.flow.standalone.SetVariable
					-name
					number of numbers per file
					-var-name
					num_rand
					-var-value
					1000
			-actor
				adams.flow.standalone.SetVariable
					-name
					combine numbers
					-var-name
					combine_numbers
					-var-value
					true
			-actor
				adams.flow.standalone.SetVariable
					-name
					output file
					-var-name
					outfile
					-var-value
					${TMP}/rand.txt
			-actor
				adams.flow.standalone.SetVariable
					-name
					write plot update interval
					-var-name
					write_plot_update
					-var-value
					100
	-actor
		adams.flow.source.Start
	-actor
		adams.flow.control.Trigger
			-name
			prompt user
			-tee
				adams.flow.source.EnterManyValues
					-name
					Enter parameters
					-stop-if-canceled
					true
					-message
					Please enter the performance test parameters
					-value
						adams.flow.source.ValueDefinition
							-name
							num_curves
							-display
							CPU: # curves
							-help
							The number of bell curves to calculate
							-type
							INTEGER
							-default-value
							@{num_curves}
					-value
						adams.flow.source.ValueDefinition
							-name
							num_means
							-display
							CPU: # means
							-help
							The number of different bell curve means to use in each iteration
							-type
							INTEGER
							-default-value
							@{num_means}
					-value
						adams.flow.source.ValueDefinition
							-name
							num_stdevs
							-display
							CPU: # standard deviations
							-help
							The number of different bell curve standard deviations to use in each iteration
							-type
							INTEGER
							-default-value
							@{num_stdevs}
					-value
						adams.flow.source.ValueDefinition
							-name
							num_points
							-display
							CPU: # data points
							-help
							The number of data points to calculate per bell curve
							-type
							INTEGER
							-default-value
							@{num_points}
					-value
						adams.flow.source.ValueDefinition
							-name
							cpu_plot_update
							-display
							CPU: plot update interval
							-help
							After how many iterations to refresh the plot
							-type
							INTEGER
							-default-value
							@{cpu_plot_update}
					-value
						adams.flow.source.ValueDefinition
							-name
							num_files
							-display
							Write: # files
							-help
							The number of files to generate
							-type
							INTEGER
							-default-value
							@{num_files}
					-value
						adams.flow.source.ValueDefinition
							-name
							num_rand
							-display
							Write: # random numbers per file
							-help
							How many random numbers to store in a single file
							-type
							INTEGER
							-default-value
							@{num_rand}
					-value
						adams.flow.source.ValueDefinition
							-name
							combine_numbers
							-display
							Write: single write operation per file
							-help
							Whether to save one number at a time or all at once
							-type
							BOOLEAN
							-default-value
							@{combine_numbers}
					-value
						adams.flow.source.ValueDefinition
							-name
							outfile
							-display
							Write: temporary file
							-help
							The temporary to use for saving the random numbers
							-type
							FILE_ABSOLUTE
							-default-value
							@{outfile}
					-value
						adams.flow.source.ValueDefinition
							-name
							write_plot_update
							-display
							Write: plot update interval
							-help
							After how many iterations to refresh the plot
							-type
							INTEGER
							-default-value
							@{write_plot_update}
					-output-type
					KEY_VALUE_PAIRS
			-tee
				adams.flow.control.Tee
					-name
					output param
					-tee
						adams.flow.transformer.StringJoin
							-glue
							: 
					-tee
						adams.flow.sink.CallableSink
							-callable
							Overall
			-tee
				adams.flow.control.Tee
					-name
					var name
					-tee
						adams.flow.transformer.GetArrayElement
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							name
			-tee
				adams.flow.control.Tee
					-name
					var value
					-tee
						adams.flow.transformer.GetArrayElement
							-index
							2
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							@{name}
	-actor
		adams.flow.control.TimedTrigger
			-name
			speed
			-tee
				adams.flow.source.ForLoop
					-upper
					@{num_curves}
			-tee
				adams.flow.control.TimedTrigger
					-name
					calc curves
					-tee
						adams.flow.source.ForLoop
							-upper
							@{num_means}
					-tee
						adams.flow.transformer.MathExpression
							-expression
							X / @{num_means}
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							mean
					-tee
						adams.flow.control.Trigger
							-name
							mean
							-tee
								adams.flow.source.ForLoop
									-upper
									@{num_stdevs}
							-tee
								adams.flow.transformer.MathExpression
									-expression
									X / @{num_stdevs}
							-tee
								adams.flow.transformer.SetVariable
									-var-name
									stdev
							-tee
								adams.flow.control.Trigger
									-name
									stdev
									-tee
										adams.flow.standalone.SetVariable
											-name
											plot name
											-var-name
											plot_name
											-var-value
											@{mean}/@{stdev}
											-expand-value
											true
									-tee
										adams.flow.source.ForLoop
											-lower
											0
											-upper
											@{num_points}
									-tee
										adams.flow.transformer.MathExpression
											-expression
											(X - (@{num_points} / 2)) / 33
									-tee
										adams.flow.transformer.MathExpression
											-name
											MathExpression-1
											-expression
											1/sqrt(2*PI*pow(@{stdev},2))*exp(-1*pow(X-@{mean},2)/(2*@{stdev}))
											-output-value-pair
											true
					-callable
					timing_cpuspeed
			-prefix
			CPU
			-callable
			timing_overall
	-actor
		adams.flow.control.TimedTrigger
			-name
			write
			-tee
				adams.flow.source.RandomNumberGenerator
					-generator
						adams.data.random.JavaRandomInt
					-max-num
					@{num_files}
			-tee
				adams.flow.transformer.Convert
					-conversion
						adams.data.conversion.DoubleToString
							-num-decimals
							0
							-fixed-decimals
							true
			-tee
				adams.flow.transformer.SetVariable
					-name
					set seed
					-var-name
					seed
			-tee
				adams.flow.control.Trigger
					-name
					delete file
					-tee
						adams.flow.source.Variable
							-var-name
							outfile
					-tee
						adams.flow.transformer.DeleteFile
			-tee
				adams.flow.control.Trigger
					-name
					generate random array
					-tee
						adams.flow.source.RandomNumberGenerator
							-generator
								adams.data.random.JavaRandomDouble
									-seed
									@{seed}
							-max-num
							@{num_rand}
					-tee
						adams.flow.transformer.SequenceToArray
							-length
							@{num_rand}
					-tee
						adams.flow.control.ArrayProcess
							-actor
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.DoubleToString
											-num-decimals
											6
											-fixed-decimals
											true
					-tee
						adams.flow.control.TimedTee
							-tee
								adams.flow.control.IfThenElse
									-condition
										adams.flow.condition.bool.Expression
											-expression
											(@{combine_numbers})
									-then
										adams.flow.control.Sequence
											-name
											then
											-actor
												adams.flow.transformer.StringJoin
													-glue
													\n
											-actor
												adams.flow.sink.DumpFile
													-output
													${HOME}/temp/rand.txt
													-append
													true
									-else
										adams.flow.control.Sequence
											-name
											else
											-actor
												adams.flow.transformer.ArrayToSequence
											-actor
												adams.flow.sink.DumpFile
													-output
													${HOME}/temp/rand.txt
													-append
													true
							-callable
							timing_write
			-prefix
			Write
			-callable
			timing_overall
	-error-handling
	ACTORS_DECIDE_TO_STOP_ON_ERROR
	-flow-execution-listener
		adams.flow.execution.NullListener

