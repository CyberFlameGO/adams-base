# Project: adams
# Date: 2014-01-23 15:43:23
# User: fracpete
#
adams.flow.control.Flow
	-annotation
	This flow shows how to do timeseries analysis using a sliding\nwindow approach on multiple timeseries loaded from the\n\"wine\" ARFF dataset.\nThe model gets built using data from start of 1980 to end of 1984.
	-actor
		adams.flow.standalone.TabView
			-width
			1300
			-actor
				adams.flow.sink.DisplayPanelManager
					-name
					train
					-provider
						adams.flow.sink.SpreadSheetDisplay
					-entry-name-variable
					entry
			-actor
				adams.flow.sink.DisplayPanelManager
					-name
					prime
					-provider
						adams.flow.sink.SpreadSheetDisplay
					-entry-name-variable
					entry
			-actor
				adams.flow.sink.DisplayPanelManager
					-name
					predict
					-provider
						adams.flow.sink.SpreadSheetDisplay
					-entry-name-variable
					entry
			-actor
				adams.flow.sink.DisplayPanelManager
					-name
					forecast
					-provider
						adams.flow.sink.TimeseriesDisplay
							-writer
								adams.gui.print.NullWriter
							-axis-x
								adams.gui.visualization.timeseries.DefaultTimeseriesXAxisPanelOptions
									-label
									time
									-type
									DATE
									-tick-generator
										adams.gui.visualization.core.axis.PeriodicityTickGenerator
									-nth-value
									1
									-width
									40
									-periodicity
									YEARLY
							-axis-y
								adams.gui.visualization.timeseries.DefaultTimeseriesYAxisPanelOptions
									-label
									value
									-tick-generator
										adams.gui.visualization.core.axis.FancyTickGenerator
									-width
									100
									-custom-format
									0
							-color-provider
								adams.gui.visualization.core.DefaultColorProvider
					-num-tokens
					@{num_timeseries}
					-entry-name-variable
					wine
	-actor
		adams.flow.standalone.CallableActors
			-actor
				adams.flow.source.WekaForecasterSetup
					-name
					setup
					-generator
						adams.flow.source.wekaforecastersetup.WekaForecasterGenerator
							-classifier
								weka.classifiers.functions.GaussianProcesses
									-L
									1.0
									-N
									0
									-K
									weka.classifiers.functions.supportVector.PolyKernel -C 250007 -E 1.0
							-lag-maker
								adams.flow.core.LagMakerOptions
									-adjust-for-trends
									true
									-time-stamp-field
									Timestamp
									-month-of-year
									true
									-quarter
									true
			-actor
				adams.flow.source.StorageValue
					-name
					model
					-storage-name
					model
	-actor
		adams.flow.standalone.SetVariable
			-var-name
			num_years
			-var-value
			9
	-actor
		adams.flow.source.Start
	-actor
		adams.flow.control.Trigger
			-name
			number of timeseries
			-tee
				adams.flow.source.Variable
					-var-name
					num_years
			-tee
				adams.flow.transformer.Convert
					-conversion
						adams.data.conversion.StringToDouble
			-tee
				adams.flow.transformer.MathExpression
					-expression
					X*2
			-tee
				adams.flow.transformer.Convert
					-name
					Convert-1
					-conversion
						adams.data.conversion.DoubleToInt
			-tee
				adams.flow.transformer.SetVariable
					-var-name
					num_timeseries
	-actor
		adams.flow.control.Trigger
			-name
			load dataset
			-tee
				adams.flow.source.FileSupplier
					-file
					${EXAMPLE_FLOWS}/data/wine.arff
			-tee
				adams.flow.transformer.WekaFileReader
					-loader
						weka.core.converters.ArffLoader
			-tee
				adams.flow.transformer.Convert
					-conversion
						adams.data.conversion.WekaInstancesToSpreadSheet
							-spreadsheet-type
								adams.data.spreadsheet.SpreadSheet
			-tee
				adams.flow.transformer.SetStorageValue
					-storage-name
					dataset-full
	-actor
		adams.flow.control.Trigger
			-name
			create subsets
			-tee
				adams.flow.source.StorageValue
					-storage-name
					dataset-full
			-tee
				adams.flow.transformer.SpreadSheetColumnIterator
					-range
					1-3
			-tee
				adams.flow.control.Tee
					-name
					subset storage name
					-tee
						adams.flow.transformer.StringInsert
							-position
							first
							-value
							subset-
							-variable
							true
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							subset_storage
			-tee
				adams.flow.transformer.Convert
					-conversion
						adams.data.conversion.SpreadSheetEscapeColumnName
			-tee
				adams.flow.transformer.SetVariable
					-var-name
					col
			-tee
				adams.flow.control.Trigger
					-name
					attribute range
					-tee
						adams.flow.source.CombineVariables
							-expression
							Date,@{col}
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							cols
			-tee
				adams.flow.control.Trigger
					-name
					create subset
					-tee
						adams.flow.source.StorageValue
							-storage-name
							dataset-full
					-tee
						adams.flow.transformer.SpreadSheetReorderColumns
							-order
							@{cols}
					-tee
						adams.flow.transformer.Convert
							-conversion
								adams.data.conversion.SpreadSheetToTimeseries
					-tee
						adams.flow.transformer.SetStorageValue
							-storage-name
							@{subset_storage}
	-actor
		adams.flow.control.Trigger
			-name
			iterate subsets
			-tee
				adams.flow.source.ListStorageNames
					-regexp
					subset-.*
			-tee
				adams.flow.transformer.SetVariable
					-var-name
					subset_storage
			-tee
				adams.flow.control.Trigger
					-name
					extract wine name
					-tee
						adams.flow.source.Variable
							-var-name
							subset_storage
					-tee
						adams.flow.transformer.StringReplace
							-find
							subset-
							-type
							SIMPLE
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							wine
			-tee
				adams.flow.control.Trigger
					-name
					train
					-tee
						adams.flow.source.StorageValue
							-storage-name
							@{subset_storage}
					-tee
						adams.flow.transformer.TimeseriesFilter
							-filter
								adams.data.filter.Window
									-start
									1980-01-01 00:00:00
									-end
									@{end}
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							entry
							-var-value
							@{wine}
					-tee
						adams.flow.control.Tee
							-tee
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.TimeseriesToSpreadSheet
											-spreadsheet-type
												adams.data.spreadsheet.SpreadSheet
							-tee
								adams.flow.sink.CallableSink
									-callable
									train
					-tee
						adams.flow.transformer.Convert
							-conversion
								adams.data.conversion.TimeseriesToWekaInstances
									-format
									yyyy-MM-dd
					-tee
						adams.flow.transformer.WekaTrainForecaster
							-forecaster
							setup
					-tee
						adams.flow.transformer.SetStorageValue
							-storage-name
							model
			-tee
				adams.flow.control.Trigger
					-name
					sliding window
					-tee
						adams.flow.source.ForLoop
							-upper
							@{num_years}
					-tee
						adams.flow.transformer.SetVariable
							-var-name
							iteration
					-tee
						adams.flow.control.Trigger
							-name
							create entry name
							-tee
								adams.flow.source.CombineVariables
									-expression
									@{subset_storage}-@{iteration}
							-tee
								adams.flow.transformer.StringReplace
									-find
									subset-
									-type
									SIMPLE
							-tee
								adams.flow.transformer.SetVariable
									-var-name
									entry
							-tee
								adams.flow.transformer.StringInsert
									-after
									true
									-value
									-actual
							-tee
								adams.flow.transformer.SetVariable
									-name
									SetVariable-1
									-var-name
									entry-actual
					-tee
						adams.flow.control.Trigger
							-name
							prime
							-tee
								adams.flow.source.StorageValue
									-storage-name
									@{subset_storage}
							-tee
								adams.flow.control.Trigger
									-name
									start
									-tee
										adams.flow.source.CombineVariables
											-expression
											1985-01-01 00:00:00 +(@{iteration} - 1) YEAR
									-tee
										adams.flow.transformer.SetVariable
											-var-name
											start
							-tee
								adams.flow.control.Trigger
									-name
									end
									-tee
										adams.flow.source.CombineVariables
											-expression
											1985-01-01 00:00:00 +(@{iteration} - 1) YEAR +1 YEAR
									-tee
										adams.flow.transformer.SetVariable
											-var-name
											end
							-tee
								adams.flow.transformer.TimeseriesFilter
									-filter
										adams.data.filter.Window
											-start
											@{start}
											-end
											@{end}
							-tee
								adams.flow.control.Tee
									-tee
										adams.flow.transformer.Convert
											-conversion
												adams.data.conversion.TimeseriesToSpreadSheet
													-spreadsheet-type
														adams.data.spreadsheet.SpreadSheet
									-tee
										adams.flow.sink.CallableSink
											-callable
											prime
							-tee
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.TimeseriesToWekaInstances
											-format
											yyyy-MM-dd
							-tee
								adams.flow.transformer.WekaPrimeForecaster
									-forecaster
									model
							-tee
								adams.flow.transformer.SetStorageValue
									-storage-name
									model
					-tee
						adams.flow.control.Trigger
							-name
							predict
							-tee
								adams.flow.source.StorageValue
									-storage-name
									@{subset_storage}
							-tee
								adams.flow.control.Trigger
									-name
									start
									-tee
										adams.flow.source.CombineVariables
											-expression
											1985-01-01 00:00:00 +(@{iteration} - 1) YEAR +1 YEAR
									-tee
										adams.flow.transformer.SetVariable
											-var-name
											start
							-tee
								adams.flow.control.Trigger
									-name
									end
									-tee
										adams.flow.source.CombineVariables
											-expression
											1985-01-01 00:00:00 +(@{iteration} - 1) YEAR +2 YEAR
									-tee
										adams.flow.transformer.SetVariable
											-var-name
											end
							-tee
								adams.flow.transformer.TimeseriesFilter
									-filter
										adams.data.filter.Window
											-start
											@{start}
											-end
											@{end}
							-tee
								adams.flow.control.Tee
									-tee
										adams.flow.transformer.Convert
											-conversion
												adams.data.conversion.TimeseriesToSpreadSheet
													-spreadsheet-type
														adams.data.spreadsheet.SpreadSheet
									-tee
										adams.flow.sink.CallableSink
											-callable
											predict
							-tee
								adams.flow.transformer.Copy
							-tee
								adams.flow.transformer.SetID
									-id
									@{entry-actual}
							-tee
								adams.flow.control.Cast
									-classname
									adams.data.timeseries.Timeseries
							-tee
								adams.flow.sink.CallableSink
									-callable
									forecast
					-tee
						adams.flow.control.Trigger
							-name
							forecast
							-tee
								adams.flow.source.WekaForecasting
									-model-actor
									model
									-on-the-fly
									true
									-num-steps
									12
							-tee
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.WekaForecastContainerToTimeseries
											-start
											@{start}
											-interval
											START +1 MONTH
							-tee
								adams.flow.transformer.SetID
									-id
									@{entry}
							-tee
								adams.flow.control.Cast
									-classname
									adams.data.timeseries.Timeseries
							-tee
								adams.flow.sink.CallableSink
									-callable
									forecast
	-flow-execution-listener
		adams.flow.execution.NullListener

